<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>psl1ght: Quick guide to SPU management</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript" src="darkmode_toggle.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">psl1ght
   </div>
   <div id="projectbrief">A free SDK for Sony&#39;s PS3 console</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('spu_man.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Quick guide to SPU management</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<p>The Cell Broadband Engine (CBE) is the processor of the PS3. It features one main core, the PPE (Power Processing Element), which is a dual threaded core from the IBM POWER family, and six Synergistic Processing Elements (SPEs) are available to the user programs.</p>
<p>The SPEs are the computing elements of the Cell Broadband Engine processor of the PS3. They feature a computing core (SPU = Synergistic Processing Unit), 256 kB of local memory (local store) and a Memory Flow Controller (MFC), responsible for DMA transfers between local store and main memory, as well as synchronization with the other SPEs and the PPE.</p>
<p>The system allows two ways of handling SPEs by either using the <em>raw SPU</em> primitives or the <em>SPU thread</em> primitives. Both methods allow to efficiently exploit the SPEs, but SPU threads allow more flexibility. This tutorial only deals with SPU threads.</p>
<h1><a class="anchor" id="spu_threads"></a>
SPU threads</h1>
<p>SPU threads are dedicated SPU programs running on the SPEs. There can be more running SPU threads as there are available SPEs, in that cas the system performs thread scheduling in order all threads to appear to be running simultaneously. However, scheduling has a cost, so performance-aware applications should try to avoid context switches by running exactly the needed number of threads. Ideally, unless in some very specific circumstances, only maximum 6 threads should be running simultaneously, as 6 SPEs are available on the PS3.</p>
<h2><a class="anchor" id="sputhr_run"></a>
Running and stopping threads</h2>
<p>Creating and running a SPU thread basically requires the following steps:</p><ul>
<li>import a SPU program into a SPU image (see <a class="el" href="sys_2spu_8h.html#aa037293a84fc9a8579d97c9b55da6198">sysSpuImageOpen</a>, <a class="el" href="lv2_2spu_8h.html#a87c4781b21b3263cff826d5bc1324f14">sysSpuImageImport</a>)</li>
<li>create a SPU thread group (see <a class="el" href="sys_2spu_8h.html#a1717d578746ce70faa708367f011d593">sysSpuThreadGroupCreate</a>).</li>
<li>create the SPU thread (<a class="el" href="sys_2spu_8h.html#ac3601cf6f05b28a4f25701988547e2b1">sysSpuThreadInitialize</a>) for that group. Eventually create several threads for the group.</li>
<li>run the SPU thread group (<a class="el" href="sys_2spu_8h.html#a7e566068f2fed0f53684c3f45f184475">sysSpuThreadGroupStart</a>).</li>
</ul>
<p>Then all threads of the group will run simultaneously. The whole thread group may eventually be preempted to allow the execution of concurrent thread groups. Obvisoulsy, if there is only one thread group running, or if all running thread groups do not exceed a total of 6 threads, no thread group is preempted.</p>
<p>The PPU can suspend and resume a thread group (<a class="el" href="sys_2spu_8h.html#a50c11cad8a5ca3acf6c59164a6bf077a">sysSpuThreadGroupSuspend</a>, <a class="el" href="sys_2spu_8h.html#ac14df3a40792c02866ccc179d021289e">sysSpuThreadGroupResume</a>), preempt it (<a class="el" href="sys_2spu_8h.html#a30b615059548296a8f3489be9d3c243b">sysSpuThreadGroupYield</a>), or even terminate it (<a class="el" href="sys_2spu_8h.html#a203d7260c4fbe14b4b0fce62ed5ad1f1">sysSpuThreadGroupTerminate</a>).</p>
<p>A SPU thread can eventually terminate itself with a call to <a class="el" href="spu__thread_8h.html#a5e1143fdec96a8197758a28a619dd20e">spu_thread_exit</a>. It also can terminate the whole SPU thread group (<a class="el" href="spu__thread_8h.html#a18a354610f911ba802370e1ebe5585e8">spu_thread_group_exit</a>), or call the SPU thread group scheduler (<a class="el" href="spu__thread_8h.html#af58f09da5bf6463004807078f7ec48cd">spu_thread_group_yield</a>).</p>
<p>A SPU thread group is terminated if all its threads are terminated.</p>
<p>The PPE must join a SPU thread group (<a class="el" href="sys_2spu_8h.html#a09da6b4a2258bed23e6d913a1db93db5">sysSpuThreadGroupJoin</a>) to ensure its threads are terminated.</p>
<h2><a class="anchor" id="sputhr_com"></a>
Communication between threads</h2>
<p>SPU threads can communicate with the running PPE threads, and also with other SPU threads within the same SPU thread group.</p>
<p>A PPE thread can :</p><ul>
<li>read or write to a SPU thread's local store (<a class="el" href="sys_2spu_8h.html#a875b04a690fd26b44a455e8e58a00e8d">sysSpuThreadWriteLocalStorage</a>, <a class="el" href="sys_2spu_8h.html#a62421187007c8e5fd4d6f48dfe662b52">sysSpuThreadReadLocalStorage</a>)</li>
<li>write to a SPU's signal notification register (<a class="el" href="sys_2spu_8h.html#aef4cbb677cd90bc8c16d29a4bf53ad73">sysSpuThreadWriteSignal</a>)</li>
</ul>
<p>A SPU thread can :</p><ul>
<li>issue DMA transfers with its MFC, between its local store and main memory, or between its local store and another SPU thread's local store. In the latter case the beginning of a SPU thread's local store effective address is <code>SPU_THREAD_BASE + spu * SPU_THREAD_OFFSET</code> (having <code>spu</code> the same thread index value as provided to <a class="el" href="sys_2spu_8h.html#ac3601cf6f05b28a4f25701988547e2b1">sysSpuThreadInitialize</a>).</li>
<li>write to another SPU's signal notification register. This must be done by writing to the memory-mapped IO registers through DMA transfers. In that case, the effective address to write to is <code>SPU_THREAD_BASE + spu * SPU_THREAD_OFFSET</code> (having <code>spu</code> the same thread index value as provided to <a class="el" href="sys_2spu_8h.html#ac3601cf6f05b28a4f25701988547e2b1">sysSpuThreadInitialize</a>) to which we add either <code>SPU_THREAD_Sig_Notify_1</code> or <code>SPU_THREAD_Sig_Notify_2</code>, depending on the signal notification register to be written to.</li>
</ul>
<p>For more information about DMA transfers and SPU programming in general, refer to the Cell Broadband Engine documentation. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
